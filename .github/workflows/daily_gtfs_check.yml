# Nom de votre workflow, visible dans l'onglet "Actions"
name: üöÄ V√©rification quotidienne GTFS Lyon

on:
  # Permet de lancer ce workflow manuellement depuis l'interface GitHub
  workflow_dispatch:

  # D√©clenche le workflow tous les jours √† 5h00 UTC
  # (C'est 6h00 √† Paris en hiver, 7h00 en √©t√©)
  schedule:
    - cron: '0 5 * * *' 

jobs:
  download-and-commit:
    permissions: 
      contents: write
    # Utilise la derni√®re version d'Ubuntu comme machine virtuelle
    runs-on: ubuntu-latest

    steps:
      # 1. R√©cup√®re le code de votre d√©p√¥t (pour avoir le script .py et l'ancien hash)
      - name: ‚¨áÔ∏è R√©cup√©rer le code
        uses: actions/checkout@v4

      # 2. Configure l'environnement Python
      - name: üêç Configurer Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' # Met en cache les d√©pendances

      # 3. Installe les d√©pendances Python (le 'requests')
      - name: üì¶ Installer les d√©pendances
        run: pip install -r requirements.txt

      # 4. Ex√©cute votre script Python
      - name: üèÉ Ex√©cuter le script de t√©l√©chargement
        env:
          # Passe les secrets GitHub √† votre script
          GRANDLYON_USER: ${{ secrets.GRANDLYON_USER }}
          GRANDLYON_PASSWORD: ${{ secrets.GRANDLYON_PASSWORD }}
        run: python download_gtfs_lyon.py

      # 5. Fait un "commit" et "push" automatique si des fichiers ont chang√©
      - name: üíæ Sauvegarder les nouveaux fichiers
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ü§ñ CI: Mise √† jour automatique des donn√©es GTFS"
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Actions Bot <actions@github.com>"
